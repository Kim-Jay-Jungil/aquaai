<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aqua.AI - 수중 사진 자동보정 서비스</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <header class="nav">
    <a class="brand" href="/">Aqua.AI</a>
    <nav class="nav-links">
      <a href="/signin.html">로그인</a>
      <a href="/signup.html">회원가입</a>
    </nav>
  </header>

  <main class="wrap">
    <!-- Hero Section -->
    <section class="hero">
      <div class="container">
        <div class="hero-content">
          <div class="hero-text">
            <h1 class="hero-title">탁해진 수중 사진, 10초 만에 원색 복원</h1>
            <p class="hero-subtitle">블루/그린 톤을 제거하고 자연스러운 색을 되살립니다. 업로드만 하세요.</p>
            <div class="hero-cta">
              <button class="btn btn--primary hero-cta-primary" onclick="scrollToUpload()">
                사진 업로드 (JPG/PNG/HEIC)
              </button>
              <button class="btn btn--tertiary hero-cta-secondary" onclick="loadSampleImages()">
                샘플로 체험하기
              </button>
            </div>
          </div>
          <div class="hero-visual">
            <div class="sample-comparison">
              <div class="comparison-slider" id="heroComparisonSlider">
                <div class="comparison-before">
                  <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 400 300'%3E%3Crect width='400' height='300' fill='%230ea5e9'/%3E%3Ctext x='200' y='150' text-anchor='middle' fill='white' font-size='24'%3E보정 전 수중 사진%3C/text%3E%3C/svg%3E" alt="보정 전 수중 사진" id="heroBeforeImg">
                  <span class="comparison-label">보정 전</span>
                </div>
                <div class="comparison-after">
                  <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 400 300'%3E%3Crect width='400' height='300' fill='%2312b8a6'/%3E%3Ctext x='200' y='150' text-anchor='middle' fill='white' font-size='24'%3E보정 후 수중 사진%3C/text%3E%3C/svg%3E" alt="보정 후 수중 사진" id="heroAfterImg">
                  <span class="comparison-label">보정 후</span>
                </div>
                <div class="comparison-handle" id="heroHandle"></div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 신뢰 요소 -->
        <div class="trust-elements">
          <div class="trust-item">
            <div class="trust-icon">⚡</div>
            <div class="trust-text">
              <strong>10초 내 처리</strong>
              <span>빠른 AI 보정</span>
            </div>
          </div>
          <div class="trust-item">
            <div class="trust-icon">🔒</div>
            <div class="trust-text">
              <strong>업로드 즉시 암호화</strong>
              <span>보관 기간 없음</span>
            </div>
          </div>
          <div class="trust-item">
            <div class="trust-icon">🎯</div>
            <div class="trust-text">
              <strong>자동 삭제</strong>
              <span>개인정보 보호</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Upload Section -->
    <section class="upload-section" id="uploadSection">
      <div class="container">
        <div class="section-header">
          <h2 class="section-title">이미지 업로드</h2>
          <p class="section-subtitle">수중 사진을 끌어다 놓거나 클릭해 선택하세요</p>
        </div>
        
        <div class="upload-area" id="uploadArea">
          <div class="upload-content">
            <div class="upload-icon">📸</div>
            <h3 class="upload-title">사진을 끌어다 놓거나 클릭해 선택</h3>
            <p class="upload-help">JPG, PNG, HEIC 지원 · 최대 10MB</p>
            <div class="upload-buttons">
              <button class="btn btn--primary upload-btn" onclick="document.getElementById('fileInput').click()">
                파일 선택
              </button>
              <button class="btn btn--tertiary demo-btn" onclick="loadSampleImages()">
                샘플로 체험하기
              </button>
            </div>
            <input id="fileInput" type="file" accept="image/*" multiple style="display: none;" />
          </div>
        </div>
        
        <!-- 보정 강도 선택 -->
        <div class="enhancement-options">
          <h3 class="options-title">보정 강도</h3>
          <div class="enhancement-controls">
            <div class="slider-container">
              <input 
                type="range" 
                id="enhancementSlider" 
                min="0" 
                max="100" 
                value="50" 
                class="enhancement-slider"
                role="slider"
                aria-label="보정 강도 조절"
                aria-valuemin="0"
                aria-valuemax="100"
                aria-valuenow="50"
              />
              <div class="slider-labels">
                <span>약</span>
                <span>보통</span>
                <span>강</span>
              </div>
            </div>
            <div class="auto-toggle">
              <label class="toggle-label">
                <input type="checkbox" id="autoToggle" checked>
                <span class="toggle-slider"></span>
                <span class="toggle-text">AUTO</span>
              </label>
            </div>
          </div>
        </div>
        
        <!-- 사용자 이메일 -->
        <div class="user-email-section">
          <label for="userEmail" class="email-label">이메일 주소 (결과 알림용)</label>
          <input 
            type="email" 
            id="userEmail" 
            placeholder="your@email.com" 
            class="email-input"
          />
        </div>
        
        <!-- 보정 시작 버튼 -->
        <div class="enhancement-start">
          <button id="enhanceBtn" class="btn btn--primary enhance-btn" disabled>
            보정 시작 (약 10초)
          </button>
        </div>
        
        <!-- 진행률 표시 -->
        <div id="progressBar" class="progress-bar" style="display: none;">
          <div class="progress-fill"></div>
        </div>
      </div>
    </section>

    <section class="results-section hidden" id="resultsSection">
      <div class="card">
        <h2>보정 결과</h2>
        <div id="resultsGrid" class="results-grid">
          <!-- 결과 이미지들이 여기에 표시됩니다 -->
        </div>
        
        <!-- 이미지 비교 슬라이더 섹션 -->
        <div id="comparisonSection" class="comparison-section hidden">
          <h3>전/후 비교</h3>
          <div class="comparison-container">
            <div class="image-comparison-slider">
              <div class="image-wrapper">
                <img id="originalImage" src="" alt="원본 이미지" />
                <img id="enhancedImage" src="" alt="향상된 이미지" />
              </div>
              <div class="slider-handle">
                <div class="slider-line"></div>
                <div class="slider-circle">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M8 5L16 12L8 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M16 5L24 12L16 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              </div>
              <div class="slider-labels">
                <span class="label-original">원본</span>
                <span class="label-enhanced">향상됨</span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="results-actions">
          <button id="downloadAllBtn" class="btn btn-secondary">전체 다운로드</button>
          <button id="shareBtn" class="btn btn-outline">공유하기</button>
        </div>
      </div>
    </section>

    <!-- API 테스트 섹션 -->
    <section class="api-test-section">
      <div class="container">
        <div class="section-header">
          <h2 class="section-title">🔧 API 상태 확인</h2>
          <p class="section-subtitle">문제 진단을 위해 API 상태를 먼저 확인해보세요.</p>
        </div>
        
        <div class="api-test-buttons">
          <button id="simpleApiBtn" class="btn btn--tertiary">간단 API 테스트</button>
          <button id="apiTestBtn" class="btn btn--tertiary">API 테스트</button>
          <button id="s3TestBtn" class="btn btn--tertiary">S3 테스트</button>
          <button id="notionTestBtn" class="btn btn--tertiary">Notion 테스트</button>
          <button id="envCheckBtn" class="btn btn--tertiary">환경변수 확인</button>
        </div>
        
        <div id="apiTestResult" class="api-test-result" style="display: none;"></div>
      </div>
    </section>

    <section class="features">
      <div class="card">
        <h2>서비스 특징</h2>
        <div class="features-grid">
          <div class="feature">
            <h3>🎯 자동 색상 보정</h3>
            <p>수중 환경의 블루/그린 톤을 자동으로 감지하고 제거</p>
          </div>
          <div class="feature">
            <h3>⚡ 빠른 처리</h3>
            <p>AI 기반으로 10초 내에 이미지 보정 완료</p>
          </div>
          <div class="feature">
            <h3>📱 모든 기기 지원</h3>
            <p>모바일, 태블릿, 데스크톱에서 편리하게 사용</p>
          </div>
          <div class="feature">
            <h3>🔒 안전한 저장</h3>
            <p>업로드된 이미지는 자동으로 삭제되어 개인정보 보호</p>
          </div>
        </div>
      </div>
    </section>

    <section class="pricing">
      <div class="card">
        <h2>요금제</h2>
        <div class="pricing-grid">
          <div class="pricing-card">
            <h3>무료</h3>
            <div class="price">₩0</div>
            <ul>
              <li>월 5장 이미지 보정</li>
              <li>기본 보정 기능</li>
              <li>웹에서 직접 사용</li>
            </ul>
            <button class="btn btn-outline">시작하기</button>
          </div>
          <div class="pricing-card featured">
            <h3>프로</h3>
            <div class="price">₩19,900<span>/월</span></div>
            <ul>
              <li>월 100장 이미지 보정</li>
              <li>고급 보정 옵션</li>
              <li>배치 처리</li>
              <li>우선 지원</li>
            </ul>
            <button class="btn btn-primary">프로 시작하기</button>
          </div>
          <div class="pricing-card">
            <h3>비즈니스</h3>
            <div class="price">₩49,900<span>/월</span></div>
            <ul>
              <li>월 1,000장 이미지 보정</li>
              <li>API 접근</li>
              <li>전용 지원</li>
              <li>맞춤형 솔루션</li>
            </ul>
            <button class="btn btn-outline">문의하기</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="foot">
    <div class="footer-content">
      <div class="footer-section">
        <h4>Aqua.AI</h4>
        <p>수중 사진을 아름답게 만드는 AI 서비스</p>
      </div>
      <div class="footer-section">
        <h4>서비스</h4>
        <a href="/">홈</a>
        <a href="/upload.html">업로드</a>
        <a href="/pricing">요금제</a>
      </div>
      <div class="footer-section">
        <h4>지원</h4>
        <a href="/help">도움말</a>
        <a href="/contact">문의</a>
        <a href="/privacy">개인정보처리방침</a>
      </div>
    </div>
    <div class="footer-bottom">
      © 2024 Aqua.AI. All rights reserved.
    </div>
  </footer>

  <script>
    // 간단한 디버깅 스크립트
    console.log('🚀 index.html 로드됨');
    
    // DOM 로드 완료 확인
    document.addEventListener('DOMContentLoaded', function() {
      console.log('📋 DOM 로드 완료');
      
      // API 테스트 버튼들 확인
      const simpleApiBtn = document.getElementById('simpleApiBtn');
      const apiTestBtn = document.getElementById('apiTestBtn');
      const s3TestBtn = document.getElementById('s3TestBtn');
      const envCheckBtn = document.getElementById('envCheckBtn');
      
      console.log('🔘 버튼 요소들:', {
        simpleApiBtn,
        apiTestBtn,
        s3TestBtn,
        envCheckBtn
      });
      
      // 간단한 API 테스트 함수들 (임시)
      if (simpleApiBtn) {
        simpleApiBtn.addEventListener('click', async function() {
          console.log('🔍 간단 API 테스트 버튼 클릭됨');
          const resultDiv = document.getElementById('apiTestResult');
          resultDiv.style.display = 'block';
          resultDiv.textContent = '간단 API 테스트 중...';
          
          try {
            const response = await fetch('/api/test-simple');
            const data = await response.json();
            resultDiv.textContent = `✅ 성공: ${JSON.stringify(data, null, 2)}`;
          } catch (error) {
            resultDiv.textContent = `❌ 오류: ${error.message}`;
          }
        });
        console.log('✅ 간단 API 테스트 버튼 이벤트 리스너 추가됨');
      }
      
      if (apiTestBtn) {
        apiTestBtn.addEventListener('click', async function() {
          console.log('🔍 API 테스트 버튼 클릭됨');
          const resultDiv = document.getElementById('apiTestResult');
          resultDiv.style.display = 'block';
          resultDiv.textContent = 'API 테스트 중...';
          
          try {
            const response = await fetch('/api/health');
            const data = await response.json();
            resultDiv.textContent = `✅ 성공: ${JSON.stringify(data, null, 2)}`;
          } catch (error) {
            resultDiv.textContent = `❌ 오류: ${error.message}`;
          }
        });
        console.log('✅ API 테스트 버튼 이벤트 리스너 추가됨');
      }
      
      if (s3TestBtn) {
        s3TestBtn.addEventListener('click', async function() {
          console.log('🔍 S3 테스트 버튼 클릭됨');
          const resultDiv = document.getElementById('apiTestResult');
          resultDiv.style.display = 'block';
          resultDiv.textContent = 'S3 테스트 중...';
          
          try {
            const response = await fetch('/api/presign-put', {
              method: 'POST',
              headers: { 'content-type': 'application/json' },
              body: JSON.stringify({
                filename: 'test-image.jpg',
                contentType: 'image/jpeg'
              })
            });
            const data = await response.json();
            resultDiv.textContent = `✅ 성공: ${JSON.stringify(data, null, 2)}`;
          } catch (error) {
            resultDiv.textContent = `❌ 오류: ${error.message}`;
          }
        });
        console.log('✅ S3 테스트 버튼 이벤트 리스너 추가됨');
      }
      
      if (envCheckBtn) {
        envCheckBtn.addEventListener('click', async function() {
          console.log('🔍 환경변수 확인 버튼 클릭됨');
          const resultDiv = document.getElementById('apiTestResult');
          resultDiv.style.display = 'block';
          resultDiv.textContent = '환경변수 확인 중...';
          
          try {
            const response = await fetch('/api/debug-env');
            const data = await response.json();
            resultDiv.textContent = `✅ 성공: ${JSON.stringify(data, null, 2)}`;
          } catch (error) {
            resultDiv.textContent = `❌ 오류: ${error.message}`;
          }
        });
        console.log('✅ 환경변수 확인 버튼 이벤트 리스너 추가됨');
      }
      
      // 이미지 URL 테스트 기능 추가
      const testImageBtn = document.createElement('button');
      testImageBtn.textContent = '🖼️ 이미지 URL 테스트';
      testImageBtn.className = 'btn btn-outline';
      testImageBtn.style.marginTop = '10px';
      testImageBtn.onclick = function() {
        const url = prompt('테스트할 이미지 URL을 입력하세요:');
        if (url) {
          console.log('🖼️ 이미지 URL 테스트:', url);
          const img = new Image();
          img.onload = function() {
            console.log('✅ 이미지 로드 성공:', url);
            alert('이미지 로드 성공!');
          };
          img.onerror = function() {
            console.log('❌ 이미지 로드 실패:', url);
            alert('이미지 로드 실패!');
          };
          img.src = url;
        }
      };
      
      // 간단한 파일 업로드 테스트 기능 추가
      const testUploadBtn = document.createElement('button');
      testUploadBtn.textContent = '📤 간단 업로드 테스트';
      testUploadBtn.className = 'btn btn-outline';
      testUploadBtn.style.marginTop = '10px';
      testUploadBtn.style.marginLeft = '10px';
      testUploadBtn.onclick = async function() {
        try {
          console.log('🔍 간단한 업로드 테스트 시작');
          
          // 테스트용 더미 파일 생성
          const testFile = new File(['test'], 'test-image.jpg', { type: 'image/jpeg' });
          console.log('📁 테스트 파일 생성:', testFile);
          
          // Presign API 테스트
          const response = await fetch('/api/presign-put', {
            method: 'POST',
            headers: { 'content-type': 'application/json' },
            body: JSON.stringify({
              filename: 'test-image.jpg',
              contentType: 'image/jpeg'
            })
          });
          
          console.log('📡 Presign API 응답:', response.status, response.statusText);
          
          if (response.ok) {
            const data = await response.json();
            console.log('✅ Presign API 성공:', data);
            
            // 실제 S3 업로드 테스트
            if (data.url) {
              console.log('🔗 S3 업로드 테스트 시작...');
              const uploadResponse = await fetch(data.url, {
                method: 'PUT',
                headers: { 
                  'content-type': 'image/jpeg',
                  'x-amz-acl': 'public-read'
                },
                body: testFile
              });
              
              console.log('📤 S3 업로드 응답:', uploadResponse.status, uploadResponse.statusText);
              
              if (uploadResponse.ok) {
                alert('✅ 전체 업로드 테스트 성공!\n\nPresign API: 성공\nS3 업로드: 성공');
              } else {
                const errorText = await uploadResponse.text();
                alert('❌ S3 업로드 실패!\n\nPresign API: 성공\nS3 업로드: 실패\n\n상태: ' + uploadResponse.status + '\n오류: ' + errorText);
              }
            } else {
              alert('Presign API 성공했지만 URL이 없습니다:\n\n' + JSON.stringify(data, null, 2));
            }
          } else {
            const errorData = await response.json();
            console.error('❌ Presign API 실패:', errorData);
            alert('Presign API 테스트 실패!\n\n' + JSON.stringify(errorData, null, 2));
          }
          
        } catch (error) {
          console.error('💥 업로드 테스트 오류:', error);
          alert('업로드 테스트 오류: ' + error.message);
        }
      };
      
      // 실제 파일로 업로드 테스트하는 기능 추가
      const testRealFileBtn = document.createElement('button');
      testRealFileBtn.textContent = '📁 실제 파일 테스트';
      testRealFileBtn.className = 'btn btn-outline';
      testRealFileBtn.style.marginTop = '10px';
      testRealFileBtn.style.marginLeft = '10px';
      testRealFileBtn.onclick = function() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        input.onchange = async function(e) {
          const file = e.target.files[0];
          if (file) {
            console.log('📁 선택된 파일:', file);
            console.log('📋 파일 정보:', {
              name: file.name,
              size: file.size,
              type: file.type,
              lastModified: new Date(file.lastModified).toISOString()
            });
            
            try {
              console.log('🔍 Presign API 호출 시작...');
              
              // Presign API 호출
              const response = await fetch('/api/presign-put', {
                method: 'POST',
                headers: { 'content-type': 'application/json' },
                body: JSON.stringify({
                  filename: file.name,
                  contentType: file.type
                })
              });
              
              console.log('📡 Presign API 응답:', response.status, response.statusText);
              console.log('📋 응답 헤더:', Object.fromEntries(response.headers.entries()));
              
              if (response.ok) {
                const data = await response.json();
                console.log('✅ Presign API 성공:', data);
                
                if (!data.url) {
                  throw new Error('Presign 응답에 URL이 없습니다: ' + JSON.stringify(data));
                }
                
                console.log('🔗 S3 업로드 시작...');
                console.log('📋 업로드 정보:', {
                  url: data.url,
                  method: 'PUT',
                  contentType: file.type,
                  fileSize: file.size
                });
                
                // S3 업로드
                const uploadResponse = await fetch(data.url, {
                  method: 'PUT',
                  headers: { 
                    'content-type': file.type,
                    'x-amz-acl': 'public-read'
                  },
                  body: file
                });
                
                console.log('📤 S3 업로드 응답:', uploadResponse.status, uploadResponse.statusText);
                console.log('📋 S3 응답 헤더:', Object.fromEntries(uploadResponse.headers.entries()));
                
                if (uploadResponse.ok) {
                  alert(`✅ 파일 업로드 성공!\n\n파일: ${file.name}\n크기: ${(file.size / 1024).toFixed(2)}KB\n타입: ${file.type}\n\nS3 Key: ${data.key || 'N/A'}\nPublic URL: ${data.publicUrl || 'N/A'}`);
                } else {
                  const errorText = await uploadResponse.text();
                  console.error('❌ S3 업로드 실패:', errorText);
                  alert(`❌ S3 업로드 실패!\n\n파일: ${file.name}\n상태: ${uploadResponse.status}\n상태 텍스트: ${uploadResponse.statusText}\n\n오류 내용: ${errorText}`);
                }
              } else {
                const errorData = await response.json().catch(() => ({ error: '응답을 JSON으로 파싱할 수 없습니다' }));
                console.error('❌ Presign API 실패:', errorData);
                alert(`❌ Presign API 실패!\n\n파일: ${file.name}\n상태: ${response.status}\n상태 텍스트: ${response.statusText}\n\n오류: ${JSON.stringify(errorData, null, 2)}`);
              }
            } catch (error) {
              console.error('💥 업로드 테스트 오류:', error);
              console.error('💥 오류 상세:', {
                name: error.name,
                message: error.message,
                stack: error.stack
              });
              
              let errorMessage = error.message;
              if (error.message === 'Failed to fetch') {
                errorMessage = '네트워크 요청 실패: API 엔드포인트에 연결할 수 없습니다. 서버 상태를 확인하세요.';
              }
              
              alert(`❌ 업로드 테스트 오류!\n\n파일: ${file.name}\n오류: ${errorMessage}\n\n💡 브라우저 개발자 도구(F12)의 콘솔 탭에서 상세한 오류 로그를 확인하세요.`);
            }
          }
        };
        input.click();
      };
      
      // API 상태 확인 기능 추가
      const checkApiStatusBtn = document.createElement('button');
      checkApiStatusBtn.textContent = '🔍 API 상태 확인';
      checkApiStatusBtn.className = 'btn btn-outline';
      checkApiStatusBtn.style.marginTop = '10px';
      checkApiStatusBtn.style.marginLeft = '10px';
      checkApiStatusBtn.onclick = async function() {
        try {
          console.log('🔍 API 상태 확인 시작...');
          
          // 1. 기본 API 엔드포인트 확인
          const healthResponse = await fetch('/api/health');
          console.log('📡 Health API 응답:', healthResponse.status, healthResponse.statusText);
          
          // 2. Presign API 엔드포인트 확인
          const presignResponse = await fetch('/api/presign-put', {
            method: 'POST',
            headers: { 'content-type': 'application/json' },
            body: JSON.stringify({
              filename: 'test.jpg',
              contentType: 'image/jpeg'
            })
          });
          console.log('📡 Presign API 응답:', presignResponse.status, presignResponse.statusText);
          
          // 3. 결과 요약
          let statusMessage = '🔍 API 상태 확인 결과:\n\n';
          
          if (healthResponse.ok) {
            statusMessage += '✅ Health API: 정상\n';
          } else {
            statusMessage += `❌ Health API: ${healthResponse.status} ${healthResponse.statusText}\n`;
          }
          
          if (presignResponse.ok) {
            statusMessage += '✅ Presign API: 정상\n';
          } else {
            statusMessage += `❌ Presign API: ${presignResponse.status} ${presignResponse.statusText}\n`;
          }
          
          // 4. 네트워크 상태 확인
          const networkInfo = {
            userAgent: navigator.userAgent,
            online: navigator.onLine,
            connection: navigator.connection ? {
              effectiveType: navigator.connection.effectiveType,
              downlink: navigator.connection.downlink
            } : 'N/A'
          };
          
          statusMessage += `\n🌐 네트워크 정보:\n`;
          statusMessage += `온라인 상태: ${networkInfo.online ? '✅ 온라인' : '❌ 오프라인'}\n`;
          if (networkInfo.connection !== 'N/A') {
            statusMessage += `연결 타입: ${networkInfo.connection.effectiveType}\n`;
            statusMessage += `다운로드 속도: ${networkInfo.connection.downlink} Mbps\n`;
          }
          
          console.log('📋 API 상태 확인 완료:', statusMessage);
          alert(statusMessage);
          
        } catch (error) {
          console.error('💥 API 상태 확인 오류:', error);
          alert(`❌ API 상태 확인 실패!\n\n오류: ${error.message}\n\n💡 브라우저 개발자 도구(F12)의 콘솔 탭에서 상세한 오류 로그를 확인하세요.`);
        }
      };
      
      // S3 CORS 설정 테스트 기능 추가
      const testS3CorsBtn = document.createElement('button');
      testS3CorsBtn.textContent = '🌐 S3 CORS 테스트';
      testS3CorsBtn.className = 'btn btn-outline';
      testS3CorsBtn.style.marginTop = '10px';
      testS3CorsBtn.style.marginLeft = '10px';
      testS3CorsBtn.onclick = async function() {
        try {
          console.log('🔍 S3 CORS 설정 테스트 시작...');
          
          // 1. Presign API 호출
          const presignResponse = await fetch('/api/presign-put', {
            method: 'POST',
            headers: { 'content-type': 'application/json' },
            body: JSON.stringify({
              filename: 'cors-test.txt',
              contentType: 'text/plain'
            })
          });
          
          if (!presignResponse.ok) {
            throw new Error(`Presign API 실패: ${presignResponse.status}`);
          }
          
          const presignData = await presignResponse.json();
          console.log('✅ Presign API 성공:', presignData);
          
          // 2. 간단한 텍스트로 S3 업로드 테스트
          const testContent = 'CORS Test Content - ' + new Date().toISOString();
          const testBlob = new Blob([testContent], { type: 'text/plain' });
          
          console.log('🔗 S3 CORS 테스트 업로드 시작...');
          
          const corsTestResponse = await fetch(presignData.url, {
            method: 'PUT',
            headers: { 
              'content-type': 'text/plain'
            },
            body: testBlob
          });
          
          console.log('📤 S3 CORS 테스트 응답:', corsTestResponse.status, corsTestResponse.statusText);
          
          if (corsTestResponse.ok) {
            alert('✅ S3 CORS 테스트 성공!\n\nS3 직접 업로드가 정상적으로 작동합니다.\n\nPresign API: 성공\nS3 업로드: 성공');
          } else {
            const errorText = await corsTestResponse.text();
            alert(`❌ S3 CORS 테스트 실패!\n\n상태: ${corsTestResponse.status}\n오류: ${errorText}\n\n💡 S3 버킷의 CORS 설정을 확인하세요.`);
          }
          
        } catch (error) {
          console.error('💥 S3 CORS 테스트 오류:', error);
          alert(`❌ S3 CORS 테스트 오류!\n\n오류: ${error.message}\n\n💡 브라우저 개발자 도구(F12)의 콘솔 탭에서 상세한 오류 로그를 확인하세요.`);
        }
      };
      
      // API 테스트 섹션에 버튼들 추가
      const apiTestSection = document.querySelector('.api-test-section');
      if (apiTestSection) {
        apiTestSection.appendChild(testImageBtn);
        apiTestSection.appendChild(testUploadBtn);
        apiTestSection.appendChild(testRealFileBtn);
        apiTestSection.appendChild(checkApiStatusBtn);
        apiTestSection.appendChild(testS3CorsBtn);
      }
    });
  </script>

  <script src="/app.js"></script>
  
  <!-- 간단한 인라인 테스트 스크립트 -->
  <script>
    console.log('🔧 인라인 테스트 스크립트 로드됨');
    
    // DOM 로드 완료 후 간단한 테스트
    document.addEventListener('DOMContentLoaded', function() {
      console.log('📋 인라인 스크립트: DOM 로드 완료');
      
      // 기본 테스트 버튼 찾기
      const basicTestBtn = document.getElementById('basicTestBtn');
      if (basicTestBtn) {
        console.log('✅ 인라인 스크립트: 기본 테스트 버튼 발견');
        
        // 인라인으로 이벤트 리스너 추가
        basicTestBtn.addEventListener('click', async function() {
          console.log('🧪 인라인 스크립트: 기본 테스트 버튼 클릭됨');
          try {
            const response = await fetch('/api/basic-test');
            const data = await response.json();
            console.log('📡 인라인 스크립트: 응답 데이터:', data);
            alert(`기본 테스트 성공!\n상태: ${response.status}\n응답: ${JSON.stringify(data, null, 2)}`);
          } catch (error) {
            console.error('❌ 인라인 스크립트: 오류:', error);
            alert(`기본 테스트 실패!\n오류: ${error.message}`);
          }
        });
      } else {
        console.error('❌ 인라인 스크립트: 기본 테스트 버튼을 찾을 수 없음');
      }
      
      // 간단 Notion 버튼 찾기
      const simpleNotionBtn = document.getElementById('simpleNotionBtn');
      if (simpleNotionBtn) {
        console.log('✅ 인라인 스크립트: 간단 Notion 버튼 발견');
        
        // 인라인으로 이벤트 리스너 추가
        simpleNotionBtn.addEventListener('click', async function() {
          console.log('🧪 인라인 스크립트: 간단 Notion 버튼 클릭됨');
          try {
            const response = await fetch('/api/simple-notion-test');
            const data = await response.json();
            console.log('📡 인라인 스크립트: 응답 데이터:', data);
            alert(`간단 Notion 테스트 성공!\n상태: ${response.status}\n응답: ${JSON.stringify(data, null, 2)}`);
          } catch (error) {
            console.error('❌ 인라인 스크립트: 오류:', error);
            alert(`간단 Notion 테스트 실패!\n오류: ${error.message}`);
          }
        });
      } else {
        console.error('❌ 인라인 스크립트: 간단 Notion 버튼을 찾을 수 없음');
      }
      
      // Notion 간단 테스트 버튼 찾기
      const notionSimpleTestBtn = document.getElementById('notionSimpleTestBtn');
      if (notionSimpleTestBtn) {
        console.log('✅ 인라인 스크립트: Notion 간단 테스트 버튼 발견');
        
        // 인라인으로 이벤트 리스너 추가
        notionSimpleTestBtn.addEventListener('click', async function() {
          console.log('🧪 인라인 스크립트: Notion 간단 테스트 버튼 클릭됨');
          try {
            const response = await fetch('/api/notion-simple-test');
            const data = await response.json();
            console.log('📡 인라인 스크립트: 응답 데이터:', data);
            alert(`Notion 간단 테스트 성공!\n상태: ${response.status}\n응답: ${JSON.stringify(data, null, 2)}`);
          } catch (error) {
            console.error('❌ 인라인 스크립트: 오류:', error);
            alert(`Notion 간단 테스트 실패!\n오류: ${error.message}`);
          }
        });
      } else {
        console.error('❌ 인라인 스크립트: Notion 간단 테스트 버튼을 찾을 수 없음');
      }
      
      // Echo 테스트 버튼 찾기
      const echoTestBtn = document.getElementById('echoTestBtn');
      if (echoTestBtn) {
        console.log('✅ 인라인 스크립트: Echo 테스트 버튼 발견');
        
        // 인라인으로 이벤트 리스너 추가
        echoTestBtn.addEventListener('click', async function() {
          console.log('🧪 인라인 스크립트: Echo 테스트 버튼 클릭됨');
          try {
            const response = await fetch('/api/echo');
            const data = await response.json();
            console.log('📡 인라인 스크립트: 응답 데이터:', data);
            alert(`Echo 테스트 성공!\n상태: ${response.status}\n응답: ${JSON.stringify(data, null, 2)}`);
          } catch (error) {
            console.error('❌ 인라인 스크립트: 오류:', error);
            alert(`Echo 테스트 실패!\n오류: ${error.message}`);
          }
        });
      } else {
        console.error('❌ 인라인 스크립트: Echo 테스트 버튼을 찾을 수 없음');
      }
    });
  </script>
</body>
</html>